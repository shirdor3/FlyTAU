{% extends "layout_page.html" %}

{% block title %}FLYTAU{% endblock %}
{% block page_title %}כל הטיסות במערכת{% endblock %}

{% block ruler %}
<ul class="nav-links">
    <li><a href="/add_crew" class="white-glow-hover">הוספת אנשי צוות</a></li>
    <li><a href="/manager_buy_aircraft" class="white-glow-hover">הוספת מטוס</a></li>
    <li><a href="/manager_add_flight" class="white-glow-hover">הוספת טיסה</a></li>
    <li><a href="/cancel_flight_manager" class="white-glow-hover">הצגת טיסות</a></li>
    <li><a href="/manager_reports" class="white-glow-hover">סטטיסטיקה ודוחות</a></li>
</ul>
{% endblock %}

{% block content %}

{% if message %}
  <p class="success-text">{{ message }}</p>
{% endif %}
{% if error %}
  <p class="error-text">{{ error }}</p>
{% endif %}

<form method="GET" action="{{ url_for('update_flight_manager') }}" class="card form" style="margin-bottom: 16px;">
  <label>סינון טיסות</label>
  <select name="filter">
    <option value="all" {% if selected_filter == 'all' %}selected{% endif %}>כל הטיסות</option>
    <option value="active_upcoming" {% if selected_filter == 'active_upcoming' %}selected{% endif %}>טיסות פעילות שטרם המריאו</option>
    <option value="full" {% if selected_filter == 'full' %}selected{% endif %}>טיסות עם תפוסה מלאה</option>
    <option value="past" {% if selected_filter == 'past' %}selected{% endif %}>טיסות שהתקיימו בעבר</option>
    <option value="canceled" {% if selected_filter == 'canceled' %}selected{% endif %}>טיסות שבוטלו</option>
  </select>
  <button class="btn-primary" type="submit">החל סינון</button>
</form>

<table class="flights-table">
  <thead>
    <tr>
      <th>מס׳ טיסה</th>
      <th>מוצא</th>
      <th>יעד</th>
      <th>המראה</th>
      <th>סטטוס</th>
      <th>תפוסה</th>
      <th>פעולה</th>
    </tr>
  </thead>
  <tbody>
    {% for f in flights %}
      <tr>
        <td>{{ f.flight_number }}</td>
        <td>{{ f.origin_airport }}</td>
        <td>{{ f.destination_airport }}</td>
        <td>{{ f.departure_datetime }}</td>
        <td>{{ f.status }}</td>

        <td>
          {{ f.taken_seats }} / {{ f.total_seats }}
          {% if f.is_full %}<strong>(מלא)</strong>{% endif %}
        </td>

        <td>
          {% if f.status == 'ACTIVE' %}
            {% if f.is_past %}
              <span>הטיסה כבר התקיימה</span>
            {% else %}
              {% if f.hours_to_departure is not none and f.hours_to_departure > 72 %}
                <form method="POST" action="{{ url_for('cancel_flight_post') }}">
                  <input type="hidden" name="flight_number" value="{{ f.flight_number }}">
                  <button class="btn-danger" type="submit"
                          onclick="return confirm('לבטל את הטיסה הזו? פעולה זו תבטל גם הזמנות פעילות מקושרות');">
                    ביטול טיסה
                  </button>
                </form>
              {% else %}
                <span>אין אפשרות לבטל כבר (פחות מ־72 שעות)</span>
              {% endif %}
            {% endif %}
          {% else %}
            <span>{{ f.status }}</span>
          {% endif %}
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>

{% endblock %}